@using Qxun.UI.Background.Config
@using Qxun.UI.Background.App_Code
@{ ViewBag.Title = "新增呼叫单";
 ViewBag.subTitle = "新增呼叫单";
 Layout = "~/Views/Shared/_Layout.cshtml";
 //如果要上传原尺寸图像，请将本参数赋值为"panorama"
 ViewData["panorama"] = "panorama";
 var platid = Request["plat"];
 var type = Request["type"];
 var formTitle = "新增呼叫单";
 string content = "", value = "";

 ViewBag.formlines = new FormLineConfig[] {
       new FormLineConfig(){desc = "呼叫单编号",name = "TicketNumber",
           type = "input-text", tips = "<span class='maroon'>*</span>请填写呼叫单编号",vaildType = "required,maxlength:32",inputContent="",functionName="onkeyup",functionStr="value=value.replace(/[^\\d]/g,'')"},
       new FormLineConfig(){desc = "客户姓名",name = "CustomerName",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写客户名称",vaildType = "required,maxlength:32",inputContent="",functionStr=""} ,
       new FormLineConfig(){desc = "来电号码",name = "CallNumber",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写来电号码。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
       new FormLineConfig(){desc = "来电日期",name = "CallDate",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写来电日期。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
       new FormLineConfig(){desc = "来电时间",name = "CallTime",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写来电时间。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
       new FormLineConfig(){desc = "呼叫单来源",name = "TicketFrom",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写呼叫单来源。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
       new FormLineConfig(){desc = "来电目的",name = "CallFor",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写来电目的。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
       new FormLineConfig(){desc = "支持工程师",name = "SupportEngineer",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写支持工程师。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
       new FormLineConfig(){desc = "状态",name = "Status",
            type = "input-text", tips = "<span class='maroon'>*</span> 选择状态。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
   };
 ViewBag.formlines1 = new FormLineConfig[]{
     new FormLineConfig(){desc = "问题描述",name = "Description",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写问题描述。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "地区",name = "Location",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写地区。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "车牌号",name = "PlateNumber",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写车牌号。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "机组序列号",name = "UnitNumber",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写机组序列号。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "反馈日期",name = "FeedBackDate",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写反馈日期。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "反馈时间",name = "FeedBackTime",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写反馈时间。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "车子归属地",name = "CarOwnership",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写车子归属地。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "来电客户公司",name = "CustomerCompany",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写来电客户公司。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "报修机组类型",name = "UnitType",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写报修机组类型。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "维修服务站",name = "ServiceStation",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写维修服务站。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "报修事宜",name = "RepairInfo",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写报修事宜。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} 
 };
 ViewBag.formlines2 = new FormLineConfig[]{
     new FormLineConfig(){desc = "受理服务站",name = "AcceptStation",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "受理情况",name = "AcceptOrNot",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写地区。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "是否在4小时内联系用户",name = "ContactIn4OrNot",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写车牌号。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "回访时间",name = "ReturnTime",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写机组序列号。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "是否解决故障",name = "SolveOrNot",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写反馈日期。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "是否解答疑问",name = "AnswerOrNot",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写反馈时间。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "是否提供信息（销售）",name = "GiveInfoOrNotforSales",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写车子归属地。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "是否解答问题（销售）",name = "AnswerOrNotforSales",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写报修事宜。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "建议",name = "Suggest",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写来电客户公司。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "评分",name = "Score",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写报修机组类型。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} ,
     new FormLineConfig(){desc = "处理结果",name = "Result",
            type = "input-text", tips = "<span class='maroon'>*</span> 请填写维修服务站。",vaildType = "required",inputContent="",functionName="onkeyup",functionStr=""} 
 };
 
 ViewBag.formsecondlines = new FormLineConfig[]{
       new FormLineConfig(){desc = "",name = "TicketId",
            type = "input-hidden", tips = "",vaildType = "",inputContent = "",inputValue=""},
       new FormLineConfig(){desc = "",name = "WeixinPlatId",
            type = "input-hidden", tips = "",vaildType = "",inputContent = "",inputValue= Request.QueryString["plat"]}
   };
}
@Html.Partial("_FormResource")
@Html.Partial("_KindEditorResource")
@Html.Partial("_DateTimePickerResource", new ViewDataDictionary() { { "className", "form_datetime" } })
<div id="main">
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
                <div class="box">
                    @Html.Partial("GoBackButton")
                    <div class="box-title">
                        <div class="span10">
                            <h3>
                                <i class="icon-edit"></i>@formTitle
                            </h3>
                        </div>
                        <div class="span2">
                        </div>
                    </div>
                    <div class="box-content">
                        <form action="" method="post" class="form-horizontal form-validate" id="form1" name="form1">
                            @(new CreateForm().CreateFormBody(ViewBag.formlines))
                            
                            @if (type == "change")
                            {
                                @(new CreateForm().CreateFormBody(ViewBag.formlines1, false))
                                //@(new CreateForm().CreateFormBody(ViewBag.formlines1, false))
                            }
                            @if (type == "repair")
                            { 
                                <div style="background-color : black;text-align:center;font-size:16px">
                                热线回访
                                </div>
                                @(new CreateForm().CreateFormBody(ViewBag.formlines1, false))
                                @(new CreateForm().CreateFormBody(ViewBag.formlines2, false))
                            }
                           
                            @(new CreateForm().CreateFormBody(ViewBag.formsecondlines, false))
                            @Html.Partial("CreateFormFoot")
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var id = jQuery.query.get("id");
    var opts = {
        primaryKeyId: id,
        getFormDataUrl: '@Url.Action("GetPartInformationEntityById", "HotLine")?id=' + id,
        postFormDataUrl: '@Url.Action("InsertOrUpdatePartInformationEntity", "HotLine")',
        returnUrl: '@Url.Action("HotLineInfo", "HotLine")@Html.Raw(@ViewBag.oQueryString)',
        validateOpts: {
            rules: {
                @(new CreateForm().CreateFormValid(ViewBag.formlines))
            }
        }
    };
    $(function () {
        @*$("body").on("click", ".btn-removeBinding-edit", function () {
            var id = $(this).attr("item-id");
            if (confirm("确定要解除绑定吗？")) {
                $.post("@Url.Action("Unbundling", "Nemak")", { id: id }, function (data) {
                    if (data.IsSuccess) {
                        alert("解绑成功，刷新查看！");
                    }
                })
            }
        })*@
                    
        
        $.post("@Url.Action("Show", "HotLine")@Html.Raw(ViewBag.oQueryString)", {}, function (data) {
            @*if (data.AllUploadRecord != null) {
                var success = data.SuccessRecord;
                var fail = data.FailRecord;
                var time = formatDate(data.UploadTime).split(".")[0];
                var all = data.AllUploadRecord;
                var a = document.getElementById("alert");
                var b = document.getElementById("notice");
                a.innerHTML = "上次历史上传成功" + success + "条，失败" + fail + "条，总共上传" + all + "条，上传时间:" + time + ",现有总数据为：@ViewBag.TotalCount";
                a.innerHTML = "上次上传时间为：" + time + "，总共上传" + all + "条数据，其中成功" + success + "条，失败" + fail + "条。"
                b.innerHTML = "现有总数据条数为：@ViewBag.TotalCount 条。         "
            }*@
            document.getElementById("sec").style.display = none;
            document.getElementById("thr").style.display = none;
        });
    })
    //formClass.extFunction.validateFun = function () {
    //    if (imgEntity.ResourceUrl === undefined || imgEntity.ResourceUrl === "") {
    //        imgEntity.showError(false, "请上传零件图片");
    //        return false;
    //    }
    //    else {
    //        imgEntity.showError(true);
    //        return true;
    //    }
    //};

    formClass.extFunction.serializeFormFun = function (json) {
        var jsondata = { "json": json, "plat": jQuery.query.get("plat") };
        return jsondata;

    };
    $(function () {
        formClass.init(opts);
    });
</script>
